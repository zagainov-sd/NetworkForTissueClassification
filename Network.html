<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>aff48237645a4ddb8a6094daef030f35</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell markdown" id="atqZGIIyNSBb">
<p>#<strong>Практическое задание №1</strong></p>
</div>
<div class="cell markdown" id="ga5g3lUhNNBy">
<p>Установка необходимых пакетов:</p>
</div>
<div class="cell code" data-execution_count="1"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="TGBk36LpukIu" data-outputId="5f0c98f7-a6da-4beb-db01-634d0dd58c11">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>q tqdm</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>upgrade <span class="op">--</span>no<span class="op">-</span>cache<span class="op">-</span><span class="bu">dir</span> gdown</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: gdown in /usr/local/lib/python3.8/dist-packages (4.4.0)
Collecting gdown
  Downloading gdown-4.5.4-py3-none-any.whl (14 kB)
Requirement already satisfied: tqdm in /usr/local/lib/python3.8/dist-packages (from gdown) (4.64.1)
Requirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from gdown) (3.8.0)
Requirement already satisfied: six in /usr/local/lib/python3.8/dist-packages (from gdown) (1.15.0)
Requirement already satisfied: requests[socks] in /usr/local/lib/python3.8/dist-packages (from gdown) (2.23.0)
Requirement already satisfied: beautifulsoup4 in /usr/local/lib/python3.8/dist-packages (from gdown) (4.6.3)
Requirement already satisfied: chardet&lt;4,&gt;=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests[socks]-&gt;gdown) (3.0.4)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests[socks]-&gt;gdown) (2022.9.24)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests[socks]-&gt;gdown) (1.24.3)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /usr/local/lib/python3.8/dist-packages (from requests[socks]-&gt;gdown) (2.10)
Requirement already satisfied: PySocks!=1.5.7,&gt;=1.5.6 in /usr/local/lib/python3.8/dist-packages (from requests[socks]-&gt;gdown) (1.7.1)
Installing collected packages: gdown
  Attempting uninstall: gdown
    Found existing installation: gdown 4.4.0
    Uninstalling gdown-4.4.0:
      Successfully uninstalled gdown-4.4.0
Successfully installed gdown-4.5.4
</code></pre>
</div>
</div>
<div class="cell markdown" id="2vQDLyHEO1Ux">
<p>Монтирование Вашего Google Drive к текущему окружению:</p>
</div>
<div class="cell code" data-execution_count="2"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="5G5KkA1Nu5M9" data-outputId="1541c24b-e901-4fd9-f1d8-ab80770222a6">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">&#39;/content/drive&#39;</span>, force_remount<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Mounted at /content/drive
</code></pre>
</div>
</div>
<div class="cell markdown" id="0Num5lHV6912">
<p>Константы, которые пригодятся в коде далее, и ссылки (gdrive
идентификаторы) на предоставляемые наборы данных:</p>
</div>
<div class="cell code" data-execution_count="3" id="ab2yCwDm7Fqb">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>EVALUATE_ONLY <span class="op">=</span> <span class="va">False</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>TEST_ON_LARGE_DATASET <span class="op">=</span> <span class="va">True</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>TISSUE_CLASSES <span class="op">=</span> (<span class="st">&#39;ADI&#39;</span>, <span class="st">&#39;BACK&#39;</span>, <span class="st">&#39;DEB&#39;</span>, <span class="st">&#39;LYM&#39;</span>, <span class="st">&#39;MUC&#39;</span>, <span class="st">&#39;MUS&#39;</span>, <span class="st">&#39;NORM&#39;</span>, <span class="st">&#39;STR&#39;</span>, <span class="st">&#39;TUM&#39;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>DATASETS_LINKS <span class="op">=</span> {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;train&#39;</span>: <span class="st">&#39;1XtQzVQ5XbrfxpLHJuL0XBGJ5U7CS-cLi&#39;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;train_small&#39;</span>: <span class="st">&#39;1qd45xXfDwdZjktLFwQb-et-mAaFeCzOR&#39;</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;train_tiny&#39;</span>: <span class="st">&#39;1I-2ZOuXLd4QwhZQQltp817Kn3J0Xgbui&#39;</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;test&#39;</span>: <span class="st">&#39;1RfPou3pFKpuHDJZ-D9XDFzgvwpUBFlDr&#39;</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;test_small&#39;</span>: <span class="st">&#39;1wbRsog0n7uGlHIPGLhyN-PMeT2kdQ2lI&#39;</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;test_tiny&#39;</span>: <span class="st">&#39;1viiB0s041CNsAK4itvX8PnYthJ-MDnQc&#39;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="cell markdown" id="fgY-ux5qOI0k">
<p>Импорт необходимых зависимостей:</p>
</div>
<div class="cell code" data-execution_count="4" id="kLHQhqiSIyvK">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.notebook <span class="im">import</span> tqdm</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> time <span class="im">import</span> sleep</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> IPython.display</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> balanced_accuracy_score</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gdown</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span></code></pre></div>
</div>
<div class="cell markdown" id="zKLI3lUyMYO9">
<hr />
<h3 id="класс-dataset">Класс Dataset</h3>
<p>Предназначен для работы с наборами данных, обеспечивает чтение
изображений и соответствующих меток, а также формирование пакетов
(батчей).</p>
</div>
<div class="cell code" data-execution_count="5" id="8N169efsw1ej">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>PROJECT_DIR <span class="op">=</span> <span class="st">&#39;dev/prak_nn_1/&#39;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Dataset:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.is_loaded <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> Path(<span class="st">&quot;/content/drive/MyDrive/&quot;</span> <span class="op">+</span> PROJECT_DIR <span class="op">+</span> name <span class="op">+</span> <span class="st">&#39;.npz&#39;</span>) </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.exists():</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&#39;Loading dataset </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss"> from npz.&#39;</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            np_obj <span class="op">=</span> np.load(<span class="bu">str</span>(p))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.images <span class="op">=</span> np_obj[<span class="st">&#39;data&#39;</span>]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.labels <span class="op">=</span> np_obj[<span class="st">&#39;labels&#39;</span>]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.n_files <span class="op">=</span> <span class="va">self</span>.images.shape[<span class="dv">0</span>]</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.is_loaded <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&#39;Done. Dataset </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> consists of </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>n_files<span class="sc">}</span><span class="ss"> images.&#39;</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> image(<span class="va">self</span>, i):</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># read i-th image in dataset and return it as numpy array</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_loaded:</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.images[i, :, :, :]</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> images_seq(<span class="va">self</span>, n<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># sequential access to images inside dataset (is needed for testing)</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n_files <span class="cf">if</span> <span class="kw">not</span> n <span class="cf">else</span> n):</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> <span class="va">self</span>.image(i)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> random_image_with_label(<span class="va">self</span>):</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get random image with label from dataset</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> np.random.randint(<span class="va">self</span>.n_files)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.image(i), <span class="va">self</span>.labels[i]</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> random_batch_with_labels(<span class="va">self</span>, n):</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create random batch of images with labels (is needed for training)</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        indices <span class="op">=</span> np.random.choice(<span class="va">self</span>.n_files, n)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        imgs <span class="op">=</span> []</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> indices:</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> <span class="va">self</span>.image(i)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>            imgs.append(<span class="va">self</span>.image(i))</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        logits <span class="op">=</span> np.array([<span class="va">self</span>.labels[i] <span class="cf">for</span> i <span class="kw">in</span> indices])</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.stack(imgs), logits</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> image_with_label(<span class="va">self</span>, i: <span class="bu">int</span>):</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># return i-th image with label from dataset</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.image(i), <span class="va">self</span>.labels[i]</span></code></pre></div>
</div>
<section id="пример-использвания-класса-dataset" class="cell markdown"
id="M-LvGqeHYgus">
<h3>Пример использвания класса Dataset</h3>
<p>Загрузим обучающий набор данных, получим произвольное изображение с
меткой. После чего визуализируем изображение, выведем метку. В будущем,
этот кусок кода можно закомментировать или убрать.</p>
</section>
<div class="cell code" data-execution_count="7"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:328}"
id="HhObWEjGJ1um" data-outputId="f06bcb3d-32aa-4b48-dd5d-bf3744e3dc17">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d_train_tiny <span class="op">=</span> Dataset(<span class="st">&#39;train_tiny&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>img, lbl <span class="op">=</span> d_train_tiny.random_image_with_label()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Got numpy array of shape </span><span class="sc">{</span>img<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, and label with code </span><span class="sc">{</span>lbl<span class="sc">}</span><span class="ss">.&#39;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Label code corresponds to </span><span class="sc">{</span>TISSUE_CLASSES[lbl]<span class="sc">}</span><span class="ss"> class.&#39;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>pil_img <span class="op">=</span> Image.fromarray(img)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>IPython.display.display(pil_img)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Loading dataset train_tiny from npz.
Done. Dataset train_tiny consists of 900 images.

Got numpy array of shape (224, 224, 3), and label with code 3.
Label code corresponds to LYM class.
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_4f7d0d5599cc4b9582e476e5864ca9f9/189661ceadd833987fddb8dc089d4ca2a8bdf64b.png" /></p>
</div>
</div>
<div class="cell markdown" id="qaBXXCWeVLYb">
<hr />
<h3 id="класс-metrics">Класс Metrics</h3>
<p>Реализует метрики точности, используемые для оценивания модели:</p>
<ol>
<li>точность,</li>
<li>сбалансированную точность.</li>
</ol>
</div>
<div class="cell code" data-execution_count="8" id="5unQ7azTinCZ">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Metrics:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> accuracy(gt: List[<span class="bu">int</span>], pred: List[<span class="bu">int</span>]):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="bu">len</span>(gt) <span class="op">==</span> <span class="bu">len</span>(pred), <span class="st">&#39;gt and prediction should be of equal length&#39;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sum</span>(<span class="bu">int</span>(i[<span class="dv">0</span>] <span class="op">==</span> i[<span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">zip</span>(gt, pred)) <span class="op">/</span> <span class="bu">len</span>(gt)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> accuracy_balanced(gt: List[<span class="bu">int</span>], pred: List[<span class="bu">int</span>]):</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> balanced_accuracy_score(gt, pred)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> print_all(gt: List[<span class="bu">int</span>], pred: List[<span class="bu">int</span>], info: <span class="bu">str</span>):</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;metrics for </span><span class="sc">{</span>info<span class="sc">}</span><span class="ss">:&#39;</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\t</span><span class="st"> accuracy </span><span class="sc">{:.4f}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(Metrics.accuracy(gt, pred)))</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\t</span><span class="st"> balanced accuracy </span><span class="sc">{:.4f}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(Metrics.accuracy_balanced(gt, pred)))</span></code></pre></div>
</div>
<div class="cell markdown" id="N1AHzTJVGU5k">
<hr />
<h3 id="класс-model">Класс Model</h3>
<p>Класс, хранящий в себе всю информацию о модели.</p>
<p>Вам необходимо реализовать методы save, load для сохранения и
заргрузки модели. Особенно актуально это будет во время тестирования на
дополнительных наборах данных.</p>
<blockquote>
<p><em>Пожалуйста, убедитесь, что сохранение и загрузка модели работает
корректно. Для этого обучите модель, протестируйте, сохраните ее в файл,
перезапустите среду выполнения, загрузите обученную модель из файла,
вновь протестируйте ее на тестовой выборке и убедитесь в том, что
получаемые метрики совпадают с полученными для тестовой выбрки
ранее.</em></p>
</blockquote>
<p>Также, Вы можете реализовать дополнительные функции, такие как:</p>
<ol>
<li>валидацию модели на части обучающей выборки;</li>
<li>использование кроссвалидации;</li>
<li>автоматическое сохранение модели при обучении;</li>
<li>загрузку модели с какой-то конкретной итерации обучения (если
используется итеративное обучение);</li>
<li>вывод различных показателей в процессе обучения (например, значение
функции потерь на каждой эпохе);</li>
<li>построение графиков, визуализирующих процесс обучения (например,
график зависимости функции потерь от номера эпохи обучения);</li>
<li>автоматическое тестирование на тестовом наборе/наборах данных после
каждой эпохи обучения (при использовании итеративного обучения);</li>
<li>автоматический выбор гиперпараметров модели во время обучения;</li>
<li>сохранение и визуализацию результатов тестирования;</li>
<li>Использование аугментации и других способов синтетического
расширения набора данных (дополнительным плюсом будет обоснование
необходимости и обоснование выбора конкретных типов аугментации)</li>
<li>и т.д.</li>
</ol>
<p>Полный список опций и дополнений приведен в презентации с описанием
задания.</p>
<p>При реализации дополнительных функций допускается добавление
параметров в существующие методы и добавление новых методов в класс
модели.</p>
</div>
<div class="cell code" data-execution_count="16" id="0pkMiB6mJ7JQ">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Model:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> tf.keras.Sequential([</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            tf.keras.Input(shape<span class="op">=</span>(<span class="dv">224</span>, <span class="dv">224</span>, <span class="dv">3</span>)),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            tf.keras.applications.resnet50.ResNet50(input_shape<span class="op">=</span>(<span class="dv">224</span>, <span class="dv">224</span>, <span class="dv">3</span>), include_top<span class="op">=</span><span class="va">False</span>, weights<span class="op">=</span><span class="st">&#39;imagenet&#39;</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            tf.keras.layers.GlobalAveragePooling2D(),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            tf.keras.layers.Dense(<span class="dv">9</span>, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>, kernel_initializer<span class="op">=</span><span class="st">&#39;he_normal&#39;</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.<span class="bu">compile</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            optimizer<span class="op">=</span>tf.keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0001</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            loss<span class="op">=</span>tf.keras.losses.sparse_categorical_crossentropy,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save(<span class="va">self</span>, name: <span class="bu">str</span>):</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.save(<span class="ss">f&#39;drive/MyDrive/prac_nn/</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load(<span class="va">self</span>, name: <span class="bu">str</span>):</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        name_to_id_dict <span class="op">=</span> {</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;best&#39;</span>: <span class="st">&#39;1-1m8BJVBGNqIK-attM4FRPFkrRbsHV7b&#39;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        url <span class="op">=</span> <span class="ss">f&#39;https://drive.google.com/drive/folders/</span><span class="sc">{</span>name_to_id_dict[name]<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        gdown.download_folder(url, quiet<span class="op">=</span><span class="va">True</span>, output<span class="op">=</span>name, use_cookies<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> tf.keras.models.load_model(name)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train(<span class="va">self</span>, dataset: Dataset):</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        X_train <span class="op">=</span> []</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        Y_train <span class="op">=</span> []</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(dataset.n_files):</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            image, label <span class="op">=</span> dataset.image_with_label(i)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>            X_train.append(image)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>            Y_train.append(label)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.fit(np.array(X_train), np.array(Y_train), epochs<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_on_dataset(<span class="va">self</span>, dataset: Dataset, limit<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        predictions <span class="op">=</span> []</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> dataset.n_files <span class="cf">if</span> <span class="kw">not</span> limit <span class="cf">else</span> <span class="bu">int</span>(dataset.n_files <span class="op">*</span> limit)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> img <span class="kw">in</span> tqdm(dataset.images_seq(n), total<span class="op">=</span>n):</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            predictions.append(<span class="va">self</span>.test_on_image(img))</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> predictions</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_on_image(<span class="va">self</span>, img: np.ndarray):</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> np.reshape(img, (<span class="dv">1</span>,<span class="dv">224</span>,<span class="dv">224</span>,<span class="dv">3</span>))</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>        prediction <span class="op">=</span> <span class="va">self</span>.model(img, training<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> tf.argmax(prediction[<span class="dv">0</span>])</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> label</span></code></pre></div>
</div>
<div class="cell markdown" id="ZMpTB6lMr00A">
<hr />
<h3 id="классификация-изображений">Классификация изображений</h3>
<p>Используя введенные выше классы можем перейти уже непосредственно к
обучению модели классификации изображений. Пример общего пайплайна
решения задачи приведен ниже. Вы можете его расширять и улучшать. В
данном примере используются наборы данных 'train_small' и
'test_small'.</p>
</div>
<div class="cell code" data-execution_count="10"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="5cTOuZD01Up6" data-outputId="6a8bc43f-1d1f-42a1-db77-07a4bc3d5c11">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>d_train <span class="op">=</span> Dataset(<span class="st">&#39;train_small&#39;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>d_test <span class="op">=</span> Dataset(<span class="st">&#39;test&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Loading dataset train_small from npz.
Done. Dataset train_small consists of 7200 images.
Loading dataset test from npz.
Done. Dataset test consists of 4500 images.
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="11"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="wBi0XpXg8_wq" data-outputId="374bc0c7-274a-43eb-b3ac-e5cd88ad3399">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> EVALUATE_ONLY:</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    model.train(d_train)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    model.save(<span class="st">&#39;best&#39;</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    model.load(<span class="st">&#39;best&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Downloading data from https://storage.googleapis.com/tensorflow/keras-applications/resnet/resnet50_weights_tf_dim_ordering_tf_kernels_notop.h5
94765736/94765736 [==============================] - 0s 0us/step
Epoch 1/2
225/225 [==============================] - 83s 302ms/step - loss: 0.2659 - accuracy: 0.9133
Epoch 2/2
225/225 [==============================] - 70s 311ms/step - loss: 0.0610 - accuracy: 0.9808
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>WARNING:absl:Found untraced functions such as _jit_compiled_convolution_op, _jit_compiled_convolution_op, _jit_compiled_convolution_op, _jit_compiled_convolution_op, _jit_compiled_convolution_op while saving (showing 5 of 53). These functions will not be directly callable after loading.
</code></pre>
</div>
</div>
<div class="cell markdown" id="CcM2EiRMVP93">
<p>Пример тестирования модели на части набора данных:</p>
</div>
<div class="cell code" data-execution_count="12"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:136,&quot;referenced_widgets&quot;:[&quot;2f78f9757576441ba0b90419961a5ecb&quot;,&quot;79c4e6b80c474cd49aa80b9778b74ce1&quot;,&quot;69c09483d460442a8ff6f499e2896bff&quot;,&quot;0405ae702aa6428a8255348731f084f7&quot;,&quot;21565fc9c8364c3aa85661943453f394&quot;,&quot;6b0c1e4f20384e8888e8b8e8295b1ec8&quot;,&quot;71a0d6693bb14e1c91e5d6b45221a5be&quot;,&quot;736a03524b5b4fec997ed941d5f8f335&quot;,&quot;5e0f367d795d4cf2a7af8d41df08e15d&quot;,&quot;ae85b8dbacd64ac281cd7a2bf4b2b4ad&quot;,&quot;a8e57263dea94a87a43b8b36bc8d31d0&quot;]}"
id="I0AqmeLEKqrs" data-outputId="e3dfc26a-b551-4e55-d512-9f8bb7b784bb">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluating model on 10% of test dataset</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>pred_1 <span class="op">=</span> model.test_on_dataset(d_test, limit<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Metrics.print_all(d_test.labels[:<span class="bu">len</span>(pred_1)], pred_1, <span class="st">&#39;10</span><span class="sc">% o</span><span class="st">f test&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb18"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;2f78f9757576441ba0b90419961a5ecb&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>metrics for 10% of test:
	 accuracy 0.9956:
	 balanced accuracy 0.9956:
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>/usr/local/lib/python3.8/dist-packages/sklearn/metrics/_classification.py:1987: UserWarning: y_pred contains classes not in y_true
  warnings.warn(&quot;y_pred contains classes not in y_true&quot;)
</code></pre>
</div>
</div>
<div class="cell markdown" id="mSwvHVVzVWZ5">
<p>Пример тестирования модели на полном наборе данных:</p>
</div>
<div class="cell code" data-execution_count="13"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:101,&quot;referenced_widgets&quot;:[&quot;dd4912729b4844638fc282f4cbc2fc49&quot;,&quot;6d674742105d4d96ad9f10106997a308&quot;,&quot;e80422f93e704091a6e546d03f549b64&quot;,&quot;767ea456fbe146dd8c05a7950270cfe4&quot;,&quot;4cdb0c110274434aa7996e2062249408&quot;,&quot;16755b752bff4f47a56b474279a64d18&quot;,&quot;c5d0a58373714dccbe782e3d2cb77409&quot;,&quot;d4ecac0124854314b11d3f14b225bf44&quot;,&quot;ad1b3d1b86c140dd9d625678ac9f33aa&quot;,&quot;98bde3c9a7b249f8a696f0f29d651bb4&quot;,&quot;addb294de00a4c2a85a95d0544280dc2&quot;]}"
id="mjI_sbMi3TMY" data-outputId="2628dd67-7c88-4381-fb95-45a7073cf5fe">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluating model on full test dataset (may take time)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> TEST_ON_LARGE_DATASET:</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    pred_2 <span class="op">=</span> model.test_on_dataset(d_test)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    Metrics.print_all(d_test.labels, pred_2, <span class="st">&#39;test&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb22"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;dd4912729b4844638fc282f4cbc2fc49&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>metrics for test:
	 accuracy 0.9684:
	 balanced accuracy 0.9684:
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="14"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:296}"
id="f72ZzCGxMvTM" data-outputId="f062b40b-7a2a-491d-f68e-59c777bf3b8d">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics._plot.confusion_matrix <span class="im">import</span> ConfusionMatrixDisplay</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> metrics.confusion_matrix(d_test.labels, pred_2)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> ConfusionMatrixDisplay(confusion_matrix<span class="op">=</span>r)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>disp.plot()</span></code></pre></div>
<div class="output execute_result" data-execution_count="14">
<pre><code>&lt;sklearn.metrics._plot.confusion_matrix.ConfusionMatrixDisplay at 0x7f46f19bcca0&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_4f7d0d5599cc4b9582e476e5864ca9f9/2dc2e195a80481245036bbc0ade20a695acbf7c1.png" /></p>
</div>
</div>
<div class="cell markdown" id="kvyEHdxEB18o">
<p>Результат работы пайплайна обучения и тестирования выше тоже будет
оцениваться. Поэтому не забудьте присылать на проверку ноутбук с
выполнеными ячейками кода с демонстрациями метрик обучения, графиками и
т.п. В этом пайплайне Вам необходимо продемонстрировать работу всех
реализованных дополнений, улучшений и т.п.</p>
<p><font color="red"> Настоятельно рекомендуется после получения
пайплайна с полными результатами обучения экспортировать ноутбук в pdf
(файл -&gt; печать) и прислать этот pdf вместе с самим ноутбуком.
</font></p>
</div>
<section id="тестирование-модели-на-других-наборах-данных"
class="cell markdown" id="RzSKAvVI6uCW">
<h3>Тестирование модели на других наборах данных</h3>
<p>Ваша модель должна поддерживать тестирование на других наборах
данных. Для удобства, Вам предоставляется набор данных test_tiny,
который представляет собой малую часть (2% изображений) набора test.
Ниже приведен фрагмент кода, который будет осуществлять тестирование для
оценивания Вашей модели на дополнительных тестовых наборах данных.</p>
<p><font color="red"> Прежде чем отсылать задание на проверку, убедитесь
в работоспособности фрагмента кода ниже. </font></p>
</section>
<div class="cell code" data-execution_count="17"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:136,&quot;referenced_widgets&quot;:[&quot;49ab298e2f1b417e82023aacc347086e&quot;,&quot;1cb711793f5b4ab4af6cd53c69059584&quot;,&quot;69e099589c0a4eddbb33f728cc21192b&quot;,&quot;18c4387e67df47cdb07e4c1c2ce7f08a&quot;,&quot;eade08dcbc9f4078a13fce1f6e22fb15&quot;,&quot;2bb539e0fcc14d9e978c823df14a2758&quot;,&quot;f5a3cb4784fa4e3cac5ddb29a3961e28&quot;,&quot;05a4689c8d3c4072bf5a4bd83d2aed53&quot;,&quot;e5956650a22a49398ea9d32e42fb56cd&quot;,&quot;98793a345f664332a0ac4900f4afe0c0&quot;,&quot;14865bf5a8304d14bad72493e5cefa77&quot;]}"
id="sdY3uTt87tqv" data-outputId="055b5f02-ccc4-43e6-f643-2a48ade47c4b">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> Model()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>final_model.load(<span class="st">&#39;best&#39;</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>d_test_tiny <span class="op">=</span> Dataset(<span class="st">&#39;test_tiny&#39;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> final_model.test_on_dataset(d_test_tiny)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>Metrics.print_all(d_test_tiny.labels, pred, <span class="st">&#39;test-tiny&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Loading dataset test_tiny from npz.
Done. Dataset test_tiny consists of 90 images.
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb28"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;49ab298e2f1b417e82023aacc347086e&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>metrics for test-tiny:
	 accuracy 0.9667:
	 balanced accuracy 0.9667:
</code></pre>
</div>
</div>
<div class="cell markdown" id="lPvyj4gscU10">
<p>Отмонтировать Google Drive.</p>
</div>
<div class="cell code" id="NfX35zNSvFWn">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>drive.flush_and_unmount()</span></code></pre></div>
</div>
<div class="cell markdown" id="RMyDxCDCspcI">
<hr />
<h1 id="дополнительные-полезности">Дополнительные "полезности"</h1>
<p>Ниже приведены примеры использования различных функций и библиотек,
которые могут быть полезны при выполнении данного практического
задания.</p>
</div>
<section id="измерение-времени-работы-кода" class="cell markdown"
id="VvLwSttCs1rB">
<h3>Измерение времени работы кода</h3>
<p>Измерять время работы какой-либо функции можно легко и непринужденно
при помощи функции timeit из соответствующего модуля:</p>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="-HnLVhwE9C9S" data-outputId="55519d20-97a8-4f03-8db7-0dea4fbf0b3c">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timeit</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorial(n):</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        res <span class="op">*=</span> i</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> factorial(n<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>n_runs <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Function f is caluclated </span><span class="sc">{</span>n_runs<span class="sc">}</span><span class="ss"> times in </span><span class="sc">{</span>timeit<span class="sc">.</span>timeit(f, number<span class="op">=</span>n_runs)<span class="sc">}</span><span class="ss">s.&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Function f is caluclated 128 times in 0.028699996999421273s.
</code></pre>
</div>
</div>
<section id="scikit-learn" class="cell markdown" id="fibGVEdguOOi">
<h3>Scikit-learn</h3>
<p>Для использования "классических" алгоритмов машинного обучения
рекомендуется использовать библиотеку scikit-learn (<a
href="https://scikit-learn.org/stable/"
class="uri">https://scikit-learn.org/stable/</a>). Пример классификации
изображений цифр из набора данных MNIST при помощи классификатора
SVM:</p>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="vXHnBzEfunAO" data-outputId="213c954d-15ea-4159-cd90-a30d74d9152c">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard scientific Python imports</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import datasets, classifiers and performance metrics</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets, svm, metrics</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The digits dataset</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>digits <span class="op">=</span> datasets.load_digits()</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The data that we are interested in is made of 8x8 images of digits, let&#39;s</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the first 4 images, stored in the `images` attribute of the</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset.  If we were working from image files, we could load them using</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># matplotlib.pyplot.imread.  Note that each image must have the same size. For these</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># images, we know which digit they represent: it is given in the &#39;target&#39; of</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># the dataset.</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>_, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>images_and_labels <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(digits.images, digits.target))</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, (image, label) <span class="kw">in</span> <span class="bu">zip</span>(axes[<span class="dv">0</span>, :], images_and_labels[:<span class="dv">4</span>]):</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    ax.imshow(image, cmap<span class="op">=</span>plt.cm.gray_r, interpolation<span class="op">=</span><span class="st">&#39;nearest&#39;</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">&#39;Training: </span><span class="sc">%i</span><span class="st">&#39;</span> <span class="op">%</span> label)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># To apply a classifier on this data, we need to flatten the image, to</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co"># turn the data in a (samples, feature) matrix:</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>n_samples <span class="op">=</span> <span class="bu">len</span>(digits.images)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> digits.images.reshape((n_samples, <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a classifier: a support vector classifier</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> svm.SVC(gamma<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into train and test subsets</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    data, digits.target, test_size<span class="op">=</span><span class="fl">0.5</span>, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="co"># We learn the digits on the first half of the digits</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>classifier.fit(X_train, y_train)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Now predict the value of the digit on the second half:</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>predicted <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>images_and_predictions <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(digits.images[n_samples <span class="op">//</span> <span class="dv">2</span>:], predicted))</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, (image, prediction) <span class="kw">in</span> <span class="bu">zip</span>(axes[<span class="dv">1</span>, :], images_and_predictions[:<span class="dv">4</span>]):</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>    ax.imshow(image, cmap<span class="op">=</span>plt.cm.gray_r, interpolation<span class="op">=</span><span class="st">&#39;nearest&#39;</span>)</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">&#39;Prediction: </span><span class="sc">%i</span><span class="st">&#39;</span> <span class="op">%</span> prediction)</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Classification report for classifier </span><span class="sc">%s</span><span class="st">:</span><span class="ch">\n</span><span class="sc">%s</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>      <span class="op">%</span> (classifier, metrics.classification_report(y_test, predicted)))</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> metrics.plot_confusion_matrix(classifier, X_test, y_test)</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>disp.figure_.suptitle(<span class="st">&quot;Confusion Matrix&quot;</span>)</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Confusion matrix:</span><span class="ch">\n</span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> disp.confusion_matrix)</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Classification report for classifier SVC(gamma=0.001):
              precision    recall  f1-score   support

           0       1.00      0.99      0.99        88
           1       0.99      0.97      0.98        91
           2       0.99      0.99      0.99        86
           3       0.98      0.87      0.92        91
           4       0.99      0.96      0.97        92
           5       0.95      0.97      0.96        91
           6       0.99      0.99      0.99        91
           7       0.96      0.99      0.97        89
           8       0.94      1.00      0.97        88
           9       0.93      0.98      0.95        92

    accuracy                           0.97       899
   macro avg       0.97      0.97      0.97       899
weighted avg       0.97      0.97      0.97       899


Confusion matrix:
[[87  0  0  0  1  0  0  0  0  0]
 [ 0 88  1  0  0  0  0  0  1  1]
 [ 0  0 85  1  0  0  0  0  0  0]
 [ 0  0  0 79  0  3  0  4  5  0]
 [ 0  0  0  0 88  0  0  0  0  4]
 [ 0  0  0  0  0 88  1  0  0  2]
 [ 0  1  0  0  0  0 90  0  0  0]
 [ 0  0  0  0  0  1  0 88  0  0]
 [ 0  0  0  0  0  0  0  0 88  0]
 [ 0  0  0  1  0  1  0  0  0 90]]
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>/usr/local/lib/python3.7/dist-packages/sklearn/utils/deprecation.py:87: FutureWarning: Function plot_confusion_matrix is deprecated; Function `plot_confusion_matrix` is deprecated in 1.0 and will be removed in 1.2. Use one of the class methods: ConfusionMatrixDisplay.from_predictions or ConfusionMatrixDisplay.from_estimator.
  warnings.warn(msg, category=FutureWarning)
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_4f7d0d5599cc4b9582e476e5864ca9f9/d32f1cbd9e6549b221f2c929f14efe4e63ec5c36.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_4f7d0d5599cc4b9582e476e5864ca9f9/ec4e9010186e33a43b265bf2738e711c6cde28f2.png" /></p>
</div>
</div>
<section id="scikit-image" class="cell markdown" id="Uu3Dny5zxcVy">
<h3>Scikit-image</h3>
<p>Реализовывать различные операции для работы с изображениями можно как
самостоятельно, работая с массивами numpy, так и используя
специализированные библиотеки, например, scikit-image (<a
href="https://scikit-image.org/"
class="uri">https://scikit-image.org/</a>). Ниже приведен пример
использования Canny edge detector.</p>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:192}"
id="5TZvy_d7xc0B" data-outputId="8d758a05-622a-4ce0-b627-ffc09f6ae4ee">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> ndimage <span class="im">as</span> ndi</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> feature</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate noisy image of a square</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> np.zeros((<span class="dv">128</span>, <span class="dv">128</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>im[<span class="dv">32</span>:<span class="op">-</span><span class="dv">32</span>, <span class="dv">32</span>:<span class="op">-</span><span class="dv">32</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> ndi.rotate(im, <span class="dv">15</span>, mode<span class="op">=</span><span class="st">&#39;constant&#39;</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> ndi.gaussian_filter(im, <span class="dv">4</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>im <span class="op">+=</span> <span class="fl">0.2</span> <span class="op">*</span> np.random.random(im.shape)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the Canny filter for two values of sigma</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>edges1 <span class="op">=</span> feature.canny(im)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>edges2 <span class="op">=</span> feature.canny(im, sigma<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># display results</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2, ax3) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">3</span>),</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                                    sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>ax1.imshow(im, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>ax1.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&#39;noisy image&#39;</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>ax2.imshow(edges1, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>ax2.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="vs">r&#39;Canny filter, $\sigma=1$&#39;</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>ax3.imshow(edges2, cmap<span class="op">=</span>plt.cm.gray)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>ax3.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="vs">r&#39;Canny filter, $\sigma=3$&#39;</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_4f7d0d5599cc4b9582e476e5864ca9f9/0e01f5afa43d77c6012145feb0bbe81a906a5d7e.png" /></p>
</div>
</div>
<section id="tensorflow-2" class="cell markdown" id="hiEWhGUQRGoH">
<h3>Tensorflow 2</h3>
<p>Для создания и обучения нейросетевых моделей можно использовать
фреймворк глубокого обучения Tensorflow 2. Ниже приведен пример
простейшей нейроной сети, использующейся для классификации изображений
из набора данных MNIST.</p>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="kDwLG7A1ReNy" data-outputId="735e282b-7174-421e-9802-881998d1a363">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install TensorFlow</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>mnist <span class="op">=</span> tf.keras.datasets.mnist</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>(x_train, y_train), (x_test, y_test) <span class="op">=</span> mnist.load_data()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>x_train, x_test <span class="op">=</span> x_train <span class="op">/</span> <span class="fl">255.0</span>, x_test <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> tf.keras.models.Sequential([</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  tf.keras.layers.Flatten(input_shape<span class="op">=</span>(<span class="dv">28</span>, <span class="dv">28</span>)),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  tf.keras.layers.Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  tf.keras.layers.Dropout(<span class="fl">0.2</span>),</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  tf.keras.layers.Dense(<span class="dv">10</span>, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>              loss<span class="op">=</span><span class="st">&#39;sparse_categorical_crossentropy&#39;</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>              metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>model.fit(x_train, y_train, epochs<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>model.evaluate(x_test,  y_test, verbose<span class="op">=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz
11490434/11490434 [==============================] - 1s 0us/step
Epoch 1/5
1875/1875 [==============================] - 5s 3ms/step - loss: 0.2939 - accuracy: 0.9143
Epoch 2/5
1875/1875 [==============================] - 5s 3ms/step - loss: 0.1433 - accuracy: 0.9570
Epoch 3/5
1875/1875 [==============================] - 5s 3ms/step - loss: 0.1073 - accuracy: 0.9682
Epoch 4/5
1875/1875 [==============================] - 5s 2ms/step - loss: 0.0893 - accuracy: 0.9724
Epoch 5/5
1875/1875 [==============================] - 5s 3ms/step - loss: 0.0756 - accuracy: 0.9764
313/313 - 1s - loss: 0.0773 - accuracy: 0.9754 - 735ms/epoch - 2ms/step
</code></pre>
</div>
<div class="output execute_result" data-execution_count="53">
<pre><code>[0.07734980434179306, 0.9753999710083008]</code></pre>
</div>
</div>
<div class="cell markdown" id="IbvktmLwRu8g">
<p><font color="red"> Для эффективной работы с моделями глубокого
обучения убедитесь в том, что в текущей среде Google Colab используется
аппаратный ускоритель GPU или TPU. Для смены среды выберите "среда
выполнения" -&gt; "сменить среду выполнения". </font></p>
</div>
<div class="cell markdown" id="nJVNOOU9Sjyf">
<p>Большое количество туториалов и примеров с кодом на Tensorflow 2
можно найти на официальном сайте <a
href="https://www.tensorflow.org/tutorials?hl=ru"
class="uri">https://www.tensorflow.org/tutorials?hl=ru</a>.</p>
</div>
<div class="cell markdown" id="GVPs3pYpS0U1">
<p>Также, Вам может понадобиться написать собственный генератор данных
для Tensorflow 2. Скорее всего он будет достаточно простым, и его легко
можно будет реализовать, используя официальную документацию TensorFlow
2. Но, на всякий случай (если не удлось сразу разобраться или хочется
вникнуть в тему более глубоко), можете посмотреть следующий отличный
туториал: <a
href="https://stanford.edu/~shervine/blog/keras-how-to-generate-data-on-the-fly"
class="uri">https://stanford.edu/~shervine/blog/keras-how-to-generate-data-on-the-fly</a>.</p>
</div>
<section id="numba" class="cell markdown" id="lwI-T0IXyN84">
<h3>Numba</h3>
<p>В некоторых ситуациях, при ручных реализациях графовых алгоритмов,
выполнение многократных вложенных циклов for в python можно существенно
ускорить, используя JIT-компилятор Numba (<a
href="https://numba.pydata.org/"
class="uri">https://numba.pydata.org/</a>). Примеры использования Numba
в Google Colab можно найти тут:</p>
<ol>
<li><a
href="https://colab.research.google.com/github/cbernet/maldives/blob/master/numba/numba_cuda.ipynb"
class="uri">https://colab.research.google.com/github/cbernet/maldives/blob/master/numba/numba_cuda.ipynb</a></li>
<li><a
href="https://colab.research.google.com/github/evaneschneider/parallel-programming/blob/master/COMPASS_gpu_intro.ipynb"
class="uri">https://colab.research.google.com/github/evaneschneider/parallel-programming/blob/master/COMPASS_gpu_intro.ipynb</a></li>
</ol>
<blockquote>
<p>Пожалуйста, если Вы решили использовать Numba для решения этого
практического задания, еще раз подумайте, нужно ли это Вам, и есть ли
возможность реализовать требуемую функциональность иным способом.
Используйте Numba только при реальной необходимости.</p>
</blockquote>
</section>
<section id="работа-с-zip-архивами-в-google-drive" class="cell markdown"
id="BxAJ00A76LcF">
<h3>Работа с zip архивами в Google Drive</h3>
<p>Запаковка и распаковка zip архивов может пригодиться при сохранении и
загрузки Вашей модели. Ниже приведен фрагмент кода, иллюстрирующий
помещение нескольких файлов в zip архив с последующим чтением файлов из
него. Все действия с директориями, файлами и архивами должны
осущетвляться с примонтированным Google Drive.</p>
</section>
<div class="cell markdown" id="ZJiKndOpPu_e">
<p>Создадим 2 изображения, поместим их в директорию tmp внутри
PROJECT_DIR, запакуем директорию tmp в архив tmp.zip.</p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:356}"
id="CRwgPtv-6nMP" data-outputId="47a4c1bd-6d18-4292-d03c-96c9de9fbff3">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>PROJECT_DIR <span class="op">=</span> <span class="st">&quot;/dev/prak_nn_1/&quot;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>arr1 <span class="op">=</span> np.random.rand(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">3</span>) <span class="op">*</span> <span class="dv">255</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>arr2 <span class="op">=</span> np.random.rand(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">3</span>) <span class="op">*</span> <span class="dv">255</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>img1 <span class="op">=</span> Image.fromarray(arr1.astype(<span class="st">&#39;uint8&#39;</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> Image.fromarray(arr2.astype(<span class="st">&#39;uint8&#39;</span>))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="st">&quot;/content/drive/MyDrive/&quot;</span> <span class="op">+</span> PROJECT_DIR</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> (Path(p) <span class="op">/</span> <span class="st">&#39;tmp&#39;</span>).exists():</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    (Path(p) <span class="op">/</span> <span class="st">&#39;tmp&#39;</span>).mkdir()</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>img1.save(<span class="bu">str</span>(Path(p) <span class="op">/</span> <span class="st">&#39;tmp&#39;</span> <span class="op">/</span> <span class="st">&#39;img1.png&#39;</span>))</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>img2.save(<span class="bu">str</span>(Path(p) <span class="op">/</span> <span class="st">&#39;tmp&#39;</span> <span class="op">/</span> <span class="st">&#39;img2.png&#39;</span>))</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>cd $p</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="op">!</span><span class="bu">zip</span> <span class="op">-</span>r <span class="st">&quot;tmp.zip&quot;</span> <span class="st">&quot;tmp&quot;</span></span></code></pre></div>
<div class="output error" data-ename="FileNotFoundError"
data-evalue="ignored">
<pre><code>---------------------------------------------------------------------------
FileNotFoundError                         Traceback (most recent call last)
&lt;ipython-input-54-e0c49c38d470&gt; in &lt;module&gt;
      9 
     10 if not (Path(p) / &#39;tmp&#39;).exists():
---&gt; 11     (Path(p) / &#39;tmp&#39;).mkdir()
     12 
     13 img1.save(str(Path(p) / &#39;tmp&#39; / &#39;img1.png&#39;))

/usr/lib/python3.7/pathlib.py in mkdir(self, mode, parents, exist_ok)
   1271             self._raise_closed()
   1272         try:
-&gt; 1273             self._accessor.mkdir(self, mode)
   1274         except FileNotFoundError:
   1275             if not parents or self.parent == self:

FileNotFoundError: [Errno 2] No such file or directory: &#39;/content/drive/MyDrive/dev/prak_nn_1/tmp&#39;
</code></pre>
</div>
</div>
<div class="cell markdown" id="MykrBSWNQQlq">
<p>Распакуем архив tmp.zip в директорию tmp2 в PROJECT_DIR. Теперь
внутри директории tmp2 содержится директория tmp, внутри которой
находятся 2 изображения.</p>
</div>
<div class="cell code" id="CwSWrYIWMAus">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="st">&quot;/content/drive/MyDrive/&quot;</span> <span class="op">+</span> PROJECT_DIR</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>cd $p</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>unzip <span class="op">-</span>uq <span class="st">&quot;tmp.zip&quot;</span> <span class="op">-</span>d <span class="st">&quot;tmp2&quot;</span></span></code></pre></div>
</div>
</body>
</html>
